---
title: "Standing-Katz chart data"
author: "Vignette Author"
date: "`r Sys.Date()`"
output: 
    rmarkdown::html_vignette:
    fig_caption: yes
vignette: >
  %\VignetteIndexEntry{Standing-Katz chart data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=F, error=T, message=F, warning=F}
knitr::opts_chunk$set(echo=T, comment=NA, error=T, warning=F, message = F, fig.align = 'center')
```

Vignettes are long form documentation commonly included in packages. Because they are part of the distribution of the package, they need to be as compact as possible. The `html_vignette` output type provides a custom style sheet (and tweaks some options) to ensure that the resulting html is as small as possible. The `html_vignette` format:

- Never uses retina figures
- Has a smaller default figure size
- Uses a custom CSS stylesheet instead of the default Twitter Bootstrap style

## How the data was collected

The Standing-Katz (SK) chart data is read directly from a scanned figure of the original plot drawn by Standing and Katz in 1951. 

The software used to digitize the data is `graphClick` for the operating system `osX` by Apple. This software has been tested and qualified by scolars wokring on a similar task of digitizing data. <paper citation here>

Each one of the SK chart curves has been digitized. There are some curves where more points were taken due to the curvature. Other curves are almost linear and few points were necessary to define the curve.


## Saving the Standing-Katz curves
If you feel you can add a Standing-Katz chart with higher resolution and improve the work of this package, you can do so. Just keep in mind certain convention to name the text files. Let's see how the curves were saved for this package.

We invoke the function `listStandingKatzCurves()` to list all the Standing-Katz curve data that has been digitized. See the `R` code chunk below:

```{r}
library(zFactor)

listStandingKatzCurves(pprRange = 'all')
```

Note that the files follow this convention:

    sk_: Sanding-Katz
    hp:  high pressure range
    lp:  low pressure range
    tpr: pseudo-reduced tempereture
    nnn: a three digit number representing the curve by the Tpr
    
Now that we know the meaning of the name of digitized curve. we could only list then the files that contain data only in the 'high pressure' range:

```{r}
library(zFactor)

listStandingKatzCurves(pprRange = 'hp')
```




## Reading the Standing-Katz chart data

The SK chart data once is read from the curves and saved on text files, it can read from `R` and viewed, plotted or saved y using the function `getStandingKatzCurve()`. The header of function looks like this:

    getStandingKatzCurve <- function(tpr = 1.3, pprRange = "lp", 
                                    tolerance = 0.01,
                                     toView = TRUE, toSave = TRUE, toPlot = TRUE) 
                                     { more code }

The user should supply at least the pseudo-reduced temperatureor $T_{pr}$ to retrieve the points from the SK chart for that particular temperature. What the user will obtain is a dataset of $P_{pr}$ vs $z$.

Here we are calling for the curve at $T_{pr}$ = 1.30, We will only plot it at this time:

```{r fig.width=5, fig.height=5}
library(zFactor)

getStandingKatzCurve(tpr = 1.3, toView = FALSE, toSave = FALSE)
```

In a simlar manner we could plot the SK curve at $T_{pr}$ = 1.3 but at the high pressure range. This is the lower part of the chart with the scale from 7.0 to 15.

We have to specify that we want the high pressure range with `hp` as shown below:

```{r fig.width=5, fig.height=5}
library(zFactor)

getStandingKatzCurve(tpr = 1.3, pprRange = 'hp', toView = FALSE, toSave = FALSE)
```


## More Examples

```{r}
library(zFactor)

ds <- getStandingKatzCurve(tpr = 1.3, pprRange = 'hp', 
                           toView = FALSE, toSave = FALSE, toPlot = FALSE)


```


```{r, echo=FALSE, results='asis'}
knitr::kable(head(ds, 10))
```

The table show us few rows of the dataset at $T_{pr}$ = 1.3 but also some columns -or variables. $P_{pr}$ and $z$ are self-explanatory. The three other columns deserve an explanation:

    isNear:   how close is the digitized point to the grid
    Ppr_near: what is the value of the nearest grid value to the point
    diff:     the difference between the Ppr of the point read and the grid
    
    
## Getting tables for multiple pseudo-reduced pressures (Tpr)    
We will choose not to plot, save ot view any of the results at this time. We limit to obtain the z vs. Ppr data at given $T_{pr}$ values in a vector.


```{r}
library(zFactor)

tpr <- c(1.05, 1.3, 1.5)

lapply(tpr, getStandingKatzData, pprRange = 'lp')
```

> Note that we have just retrieved the z vs. Ppr data for three Tpr curves with one sentence.

## Get one `z` point for a `Ppr` at a curve `Tpr`

```{r}
library(zFactor)

tpr_vec <- c(1.3, 1.5, 1.7, 2.0)
res_li <- lapply(tpr_vec, getStandingKatzData, pprRange = 'lp')
names(res_li) <- tpr_vec
res_li
```

```{r}
# create z table (matrix) for a set of Tpr and Ppr
tpr_vec <- c(1.3, 1.5, 1.7, 2.0)
ppr_vec <- c(0.5, 1.5, 2.5, 3.5, 4.5, 5.5, 6.5)

# get list of dataframes at given Tpr
res_li <- lapply(tpr_vec, getStandingKatzData, pprRange = 'lp')
names(res_li) <- tpr_vec

tbl_mx <- matrix(nrow = length(tpr_vec), ncol = 0)
# tbl_mx <- matrix(byrow = TRUE)
for (p in ppr_vec) {
    z_vec <- vector("numeric")
    for (t in tpr_vec) {
        t_str <- as.character(t)
        df <- res_li[[t_str]]
        z_vec <- c(z_vec, df[which(res_li[[t_str]]["Ppr_near"] == p), "z"])
        z_mx <- matrix(z_vec)
        # print(z_mx)
        colnames(z_mx) <- p
        print(z_mx)
    }
    tbl_mx <- cbind(tbl_mx, z_mx)
}
rownames(tbl_mx) <- tpr_vec
# tbl_mx <-  tbl_mx[, c(2:8)]
tbl_mx
```



```{r}
library(zFactor)

f <- function(res_li, asked_tpr) {
    asked_tpr_str <- as.character(asked_tpr)
    df <- res_li[[asked_tpr_str]]
    df[which(res_li[[asked_tpr_str]]["Ppr_near"] == asked_ppr), "z"]
}
    
    
asked_tpr <- 1.5
asked_ppr <- 2.0

tpr_vec <- c(1.3, 1.5, 1.7, 2.0)
res_li <- lapply(tpr_vec, getStandingKatzData, pprRange = 'lp')
names(res_li) <- tpr_vec


f(res_li, asked_tpr)

```



