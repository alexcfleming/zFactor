---
title: "Measuring the *error* in calculating $z$"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## Practical example
To demonstrate graphically the difference between correlation and experimental data we will use the Dranchuk-AbouKassem results at a $T_{pr}$=1.05 at various $P_{pr}$.

```{r}
library(zFactor)
zFactor:::z.plot.range("DAK", interval = "fine")
```


```{r}
library(dplyr)
correlation <- "DAK"
# get all `lp` Tpr curves
tpr_all <- getStandingKatzTpr(pprRange = "lp")
# ppr <- c(0.5, 1.0, 1.5, 2.0, 2.5, 3.0, 3.5, 4.0, 4.5, 5.0, 5.5, 6.0, 6.5, 7.0)
ppr <- zFactor:::getStandingKatzPpr(interval = "fine")
sk_corr_all <- createTidyFromMatrix(ppr, tpr_all, correlation)
sk_corr_all
grouped <- group_by(sk_corr_all, Tpr, Ppr)
grouped
smry_tpr_ppr <- summarise(grouped,  z.chart, z.calc,
                          RMSE = sqrt(mean((z.chart-z.calc)^2)),
                          MPE  = sum((z.calc - z.chart) / z.chart) * 100 / n(),
                          MAPE = sum(abs((z.calc - z.chart) / z.chart)) * 100 / n(),
                          MSE  = sum((z.calc - z.chart)^2) / n(),
                          RSS  = sum((z.calc - z.chart)^2),
                          MAE  = sum(abs(z.calc - z.chart)) / n()
                         
)
smry_tpr_ppr
```


```{r}
smry_tpr_105 <- smry_tpr_ppr[smry_tpr_ppr$Tpr=="1.05", ]
smry_tpr_105
```

```{r}
plot(smry_tpr_105$Ppr, smry_tpr_105$RMSE)
```


```{r}
plot(smry_tpr_105$Ppr, smry_tpr_105$z.chart, type = "l")
points(smry_tpr_105$Ppr, smry_tpr_105$z.calc, cex = 1.25)
points(smry_tpr_105$Ppr, smry_tpr_105$RMSE)
```



```{r}
library(ggplot2)
ggplot(smry_tpr_ppr, aes(x = Ppr, y = z.chart, group = Tpr, color = Tpr)) + 
    geom_line() + 
    geom_point(aes(y=z.calc), col = "blue") +
    geom_crossbar(aes(ymin=z.chart-RMSE, ymax=z.chart+RMSE), width = 0.25, col = "orange") +
    geom_linerange(aes(ymin = z.chart-RMSE, ymax = z.chart+RMSE), col = "orange")

ggplot(smry_tpr_ppr, aes(x=Ppr, y=RMSE)) +  geom_line() + geom_point()
```


```{r}
# MPE
library(ggplot2)
ggplot(smry_tpr_105, aes(x = Ppr, y = z.chart)) + 
    geom_line() + 
    geom_point(aes(y=z.calc), col = "blue") +
    geom_crossbar(aes(ymin=z.chart-MPE, ymax=z.chart+MPE), width = 0.25, col = "orange")
    #+ geom_linerange(aes(ymin = z.chart-MPE, ymax = z.chart+MPE), col = "orange")

ggplot(smry_tpr_105, aes(x=Ppr, y=MPE)) +  geom_line() + geom_point()
```

```{r}
# MAPE

library(ggplot2)
ggplot(smry_tpr_105, aes(x = Ppr, y = z.chart)) + 
    geom_line() + 
    geom_point(aes(y=z.calc), col = "blue") +
    geom_crossbar(aes(ymin=z.chart-MAPE, ymax=z.chart+MAPE), width = 0.25, col = "orange")
    #+ geom_linerange(aes(ymin = z.chart-MPE, ymax = z.chart+MPE), col = "orange")

ggplot(smry_tpr_105, aes(x=Ppr, y=MAPE)) +  geom_line() + geom_point()
```



```{r}
# MSE

library(ggplot2)
ggplot(smry_tpr_105, aes(x = Ppr, y = z.chart)) + 
    geom_line() + 
    geom_point(aes(y=z.calc), col = "blue") +
    geom_crossbar(aes(ymin=z.chart-MSE, ymax=z.chart+MSE), width = 0.25, col = "orange")
    #+ geom_linerange(aes(ymin = z.chart-MPE, ymax = z.chart+MPE), col = "orange")

ggplot(smry_tpr_105, aes(x=Ppr, y=MSE)) +  geom_line() + geom_point()
```

```{r}
library(ggplot2)
ggplot(smry_tpr_105, aes(x=Ppr, y=RSS)) +  geom_line() + geom_point()
    #geom_point(aes(y=z.calc), col = "blue") +
    #geom_crossbar(aes(ymin=z.chart-RSS, ymax=z.chart+RSS), width = 0.25, col = "orange")
```

```{r}
library(ggplot2)
ggplot(smry_tpr_105, aes(x=Ppr, y=MAE)) + 
    geom_line() + geom_point()
    #geom_point(aes(y=z.calc), col = "blue") +
    #geom_crossbar(aes(ymin=z.chart-RSS, ymax=z.chart+RSS), width = 0.25, col = "orange")
```

```{r}
# RSS

library(ggplot2)
ggplot(smry_tpr_105, aes(x = Ppr, y = z.chart)) + 
    #geom_line() + 
    #geom_point(aes(y=z.calc), col = "blue") +
    geom_crossbar(aes(ymin=z.chart-RSS, ymax=z.chart+RSS), width = 0.25, col = "orange")
    #+ geom_linerange(aes(ymin = z.chart-MPE, ymax = z.chart+MPE), col = "orange")

ggplot(smry_tpr_105, aes(x=Ppr, y=RSS)) +  geom_line() + geom_point()
```

```{r}
library(zFactor)
library(tibble)

dak <- z.stats("DAK")
dak
dak_105 <- dak[dak$Tpr=="1.05", ]
dak_105
```

## Accuracy measurement
The comparative analysis shows tables with different error measurements:

    RMSE:  Root Mean Squared Error
    MPE:   Mean Percentage error
    MAPE:  Mean Absolute Percentage Error
    MSE:   Mean Squared Error
    RSS:   Residual sum of Squares
    MAE:   Mean Absolute Error


where:

$a_t$ are the observed true values. In our case the Standing-Katz chart $z$ values;    
$f_t$ are the calculated or predicted values (the $z$ values calculated by the correlations); and    
$n$ is the number of samples


## RMSE
Measure of accuracy, to compare errors of different calculation models for the same dataset.

$$RMSE =  \sqrt {\sum_{t=1}^n \frac {(a_t - f_t)^2} {n}}$$

<u>RMSE code</u>
```{r eval=FALSE}
RMSE = sqrt(mean((z.chart - z.calc)^2))
```



## MPE: Mean Percentage error


$$MPE = \frac {100%} {n} \sum_{t=1}^n \frac {a_t - f_t} {a_t}$$

<u>MPE code</u>
```{r eval=FALSE}
MPE  = sum((z.calc - z.chart) / z.chart) * 100 / n(),
```


## MAPE: Mean Absolute Percentage Error

$$MAPE = \frac {100} {n} \sum | \frac {a_t - f_t} {a_t}|$$

<u>MAPE code</u>
```{r eval=FALSE}
MAPE = sum(abs((z.calc - z.chart) / z.chart)) * 100 / n()
```


## MSE: Mean Squared Error
$$MSE = \frac {1}{n}  \sum_{t=1}^n (a_t - f_t)^2 $$
<u>MSE code</u>
```{r eval=FALSE}
MSE  = sum((z.calc - z.chart)^2) / n()
```



## RSS: Residual sum of Squares
$$RSS =  \sum_{t=1}^n (a_t - f_t)^2 $$
<u>RSS code</u>
```{r eval=FALSE}
RSS  = sum((z.calc - z.chart)^2)
```


## MAE: Mean Absolute Error

$$MAE = \frac {1} {n} \sum | {a_t - f_t} |$$
<u>MAE code</u>
```{r eval=FALSE}
MAE  = sum(abs(z.calc - z.chart)) / n()
```
